#include <iostream>
#include <fstream>
#include <algorithm>
#include <string>
#include <sstream>
#include <TH1F.h>
#include <TFile.h>
#include <TROOT.h>
#include <TString.h>
#include <TSystem.h>
#include <Rtypes.h>
#include <TLatex.h>

#include <TMath.h>
#include <TAxis.h>
#include <TCanvas.h>
#include <TLegend.h>
#include <TAttLine.h>
#include <TPaveText.h>
#include <TColor.h>

#include "TGraphAsymmErrors.h"

#include "TTree.h"
#include "TCanvas.h"

//#include "HttStyles.h"
#include "HttStyles.h"
//#include "/home/arapyan/cms/cmssw/029a/CMSSW_7_1_6_patch1/src/delphes-dihiggs/Utils/CMS_lumi_v2.h"

void plot_chargedAll6()
{
  //gROOT->Macro("HttStyles.cc++");
  setTDRStyle();
  std::string xaxis = "#it{m}(H^{#pm}) [GeV]";
  std::string yaxis = "#sigma_{VBF}(H^{#pm}) #times B(H^{#pm}#rightarrow W^{#pm}Z) [fb]";
  //std::string yaxis = "sin #theta = #frac{2#sqrt{2}v_{#chi}}{v}";
  
  // sh = 2sqrt(2)v_chi/v; v=246 GeV
  //The BR(WZ->3lnu)
  double br = 0.0328973292;

  double thp[9] = {0.6929,0.3560,0.2006,0.1203,0.07529,0.03220,0.02172,0.01487};
  double thm[9] = {0.4187,0.2022,0.1081,0.06178,0.03705,0.02301,0.01466,0.009547,0.006316};
  double th[9];


  double mass[11]={200,300,400,500,600,700,800,900,1000,1500,2000};
  /*
  double medianMD[11] ={0.5032376783507525, 0.5780352079081108, 0.6483256653647039, 0.5597769837435567, 0.6233187759764831, 0.6151245530741626, 0.6919289897551876, 0.7428908463182581, 0.821570999555333, 1.1096269396202676, 1.7973897490100883};
  double up68MD[11] ={0.10116118958851883, 0.11811283256786809, 0.13247563586753566, 0.13085523810481092, 0.1436925126776827, 0.16244407960364188, 0.17944791684127617, 0.20085853995385786, 0.22213157689835594, 0.3411930462917176, 0.6068409147761185};
  double low68MD[11] ={0.08135849936551888, 0.09428819593608358, 0.10337125712007336, 0.09989301558587728, 0.10954179873331797, 0.11709197779419392, 0.1306503041294602, 0.14800841262454056, 0.16368407668130477, 0.24729410733355292, 0.4340437411461649};
  double up95MD[11] ={0.2125497108628812, 0.2476900288409639, 0.2749858386197382, 0.2802338037816396, 0.30870063039473483, 0.34639667896710347, 0.38350300157406053, 0.43568063645938354, 0.4818239126317309, 0.740766017634606, 1.3217517339926415};
  double low95MD[11] ={0.1398302500928558, 0.1621799006669124, 0.1801445794493501, 0.16940402102590632, 0.18689129502655374, 0.19838759900104452, 0.22116772697277987, 0.2482352176735096, 0.27452600462045623, 0.41092808630768696, 0.7125971887472861};
  
  double median[11] ={725.5559810124657, 529.9217767080575, 404.56393705668904, 194.68452370098885, 162.87022348643703, 110.63779029836684, 100.1913036607528, 84.28415355347688, 76.21186842441149, 52.944693640634775, 45.22853873785168};
  double up68[11] ={321.02276482490583, 238.68886478599518, 182.22483474904595, 101.65871785485479, 83.74778456765279, 66.15104462217656, 58.706928811922666, 51.73788515899456, 46.78269591431555, 37.56508751479631, 35.69601244780644};
  double low68[11] ={215.6374316529708, 158.78005856336017, 118.72520400638075, 63.283758673128744, 52.2153483273611, 38.11193347627153, 34.26418809077107, 30.238819566897597, 27.342703821089174, 20.9691233541308, 19.206566017632717};
  double up95[11] ={742.3313144741128, 551.4481795263866, 415.9712913311979, 243.71601621751165, 201.27212139255508, 159.6927581960166, 141.8407452172482, 127.84862106187187, 115.60396370285711, 94.285332498478, 90.97807153598687};
  double low95[11] ={347.18987372666817, 255.6458571228324, 193.5901651931422, 100.00396432296888, 83.02564126945326, 59.856773266889874, 53.81368848966214, 46.91598391160335, 42.42262207218218, 31.952949872961224, 28.753690154630316};
  double observed[11] = {573.5662889278319, 892.0053006637349, 634.7094798400739, 178.54935364268286, 131.07260840320157, 88.88384324640589, 71.61161196780563, 55.77290564575544, 48.91887198004883, 37.42084034415237, 35.81554230166372};
  double observedMD[11] = {0.44743452880442014, 0.7499496833326408, 0.8120581386902441, 0.5360785921387211, 0.5591718940260733, 0.5513440958786189, 0.5849762548599449, 0.6043154223472351, 0.6582214233911281, 0.9328730358557906, 1.5994539760641469};
  */

double medianMD[11] ={0.5025785586463464, 0.5780352079081108, 0.6483256653647039, 0.5597769837435567, 0.6233187759764831, 0.6151245530741626, 0.6919289897551876, 0.7428908463182581, 0.821570999555333, 1.1096269396202676, 1.7973897490100883};
  double up68MD[11] ={0.10269438986131375, 0.11811283256786809, 0.13247563586753566, 0.13085523810481092, 0.1436925126776827, 0.16244407960364188, 0.17944791684127617, 0.20085853995385786, 0.22213157689835594, 0.3411930462917176, 0.6068409147761185};
  double low68MD[11] ={0.0801328456445818, 0.09428819593608358, 0.10337125712007336, 0.09989301558587728, 0.10954179873331797, 0.11709197779419392, 0.1306503041294602, 0.14800841262454056, 0.16368407668130477, 0.24805699276895474, 0.4340437411461649};
  double up95MD[11] ={0.21316753421388795, 0.2476900288409639, 0.2749858386197382, 0.2802338037816396, 0.30870063039473483, 0.34639667896710347, 0.38350300157406053, 0.43568063645938354, 0.4818239126317309, 0.740766017634606, 1.3217517339926415};
  double low95MD[11] ={0.13964710626823143, 0.1621799006669124, 0.1801445794493501, 0.16940402102590632, 0.18689129502655374, 0.19838759900104452, 0.22116772697277987, 0.2482352176735096, 0.27452600462045623, 0.40920926734311186, 0.7125971887472861};
  
  /*
  double median[11] ={723.6566198056269, 529.9217767080575, 404.56393705668904, 194.68452370098885, 162.87022348643703, 110.63779029836684, 100.1913036607528, 84.28415355347688, 76.21186842441149, 52.944693640634775, 45.22853873785168};
  double up68[11] ={325.95143558349696, 238.68886478599518, 182.22483474904595, 101.65871785485479, 83.74778456765279, 66.15104462217656, 58.706928811922666, 51.73788515899456, 46.78269591431555, 37.56508751479631, 35.69601244780644};
  double low68[11] ={212.36762986345087, 158.78005856336017, 118.72520400638075, 63.283758673128744, 52.2153483273611, 38.11193347627153, 34.26418809077107, 30.238819566897597, 27.342703821089174, 21.02567438798768, 19.206566017632717};
  double up95[11] ={744.0613051534133, 551.4481795263866, 415.9712913311979, 243.71601621751165, 201.27212139255508, 159.6927581960166, 141.8407452172482, 127.84862106187187, 115.60396370285711, 94.285332498478, 90.97807153598687};
  double low95[11] ={346.28099971167694, 255.6458571228324, 193.5901651931422, 100.00396432296888, 83.02564126945326, 59.856773266889874, 53.81368848966214, 46.91598391160335, 42.42262207218218, 31.84954226819436, 28.753690154630316};
  double observed[11] = {572.9246812172728, 891.4516229434751, 634.504597834406, 178.90575901779084, 131.08157089794318, 88.73330998844473, 71.76255833983963, 55.76961676545917, 48.91653074977746, 37.41938587412888, 35.81474108822911};
  double observedMD[11] = {0.44718420222718197, 0.7497168961030004, 0.811927063344726, 0.5366133631633639, 0.5591910112525988, 0.5508770211549412, 0.5855924507476398, 0.6042976041040958, 0.6582056721452572, 0.9328549062649196, 1.5994360856302965};
  */

  double median[11] ={719.857897391949, 526.1230542943796, 404.56393705668904, 194.68452370098885, 162.87022348643703, 110.63779029836684, 100.1913036607528, 83.80931325176715, 76.21186842441149, 52.944693640634775, 45.22853873785168};
  double up68[11] ={318.5016827835774, 232.78356020861656, 175.77437965438457, 100.10667636088755, 82.44936413571324, 64.82801851298166, 57.90818621456427, 51.44639917666757, 46.78269591431555, 37.56508751479631, 34.974883517927196};
  double low68[11] ={212.19750580516006, 156.3653982498074, 120.2376561539042, 63.67439191327733, 52.2153483273611, 38.11193347627153, 34.26418809077107, 29.96295485670325, 27.342703821089174, 21.02567438798768, 19.206566017632717};
  double up95[11] ={727.5122627730497, 538.2873591914505, 406.78696870356055, 238.26567032276483, 197.65836179659644, 156.62982957993438, 141.49754094156177, 125.25966328893912, 115.60396370285711, 94.285332498478, 90.06538639430646};
  double low95[11] ={341.651306770007, 251.75810215258394, 193.5901651931422, 100.00396432296888, 83.02564126945326, 59.856773266889874, 53.81368848966214, 46.48797844433959, 42.42262207218218, 31.84954226819436, 28.753690154630316};
  double observed[11] = {570.9393507558988, 885.010424529273, 631.6991362591212, 178.48935760109566, 130.7639045810517, 88.60381602980273, 71.69464077083612, 55.70704231479244, 48.854138015682445, 37.37975521704714, 35.778896877820756};
  double observedMD[11] = {0.44640872605734216, 0.7470034397828841, 0.8101301074016244, 0.535988518175642, 0.5585130215843014, 0.550474910092106, 0.5853152767496521, 0.6039584929030861, 0.6577857695635827, 0.9323607847580166, 1.5986355091993019};


  /*    
   TGraphAsymmErrors* outerBand=new TGraphAsymmErrors(9,mass,medianMD,0,0,low95MD,up95MD);
  TGraphAsymmErrors* innerBand=new TGraphAsymmErrors(9,mass,medianMD,0,0,low68MD,up68MD);
  TGraph *expected = new TGraph(9,mass,medianMD);

  TGraph *observedl = new TGraph(9,mass,observedMD);
  
  */
  TGraphAsymmErrors* outerBand=new TGraphAsymmErrors(11,mass,median,0,0,low95,up95);
  TGraphAsymmErrors* innerBand=new TGraphAsymmErrors(11,mass,median,0,0,low68,up68);
  TGraph *expected = new TGraph(11,mass,median);

  TGraph *observedl = new TGraph(11,mass,observed);  
  

  int shift_label = 1.;
    
   // draw a frame to define the range
  TCanvas *canv = MakeCanvas("canv", "histograms", 800, 600);
  canv->cd();
  //TH1F* hr=canv->DrawFrame(expected->GetX()[0]-shift_label*.01, 0.1, expected->GetX()[expected->GetN()-1]+.01, 1.);

  TH1F* hr=canv->DrawFrame(expected->GetX()[0]-shift_label*.01, 0.1, expected->GetX()[expected->GetN()-1]+.01, 1500.);
  // format x axis
  hr->SetXTitle(xaxis.c_str());
  hr->GetXaxis()->SetLabelFont(62);
  hr->GetXaxis()->SetLabelSize(0.045);
  hr->GetXaxis()->SetLabelOffset(0.015);
  hr->GetXaxis()->SetTitleSize(0.05);
  hr->GetXaxis()->SetTitleFont(62);
  hr->GetXaxis()->SetTitleColor(1);
  hr->GetXaxis()->SetTitleOffset(1.05);
  // format y axis
  hr->SetYTitle(yaxis.c_str());
  hr->GetYaxis()->SetLabelFont(62);
  hr->GetYaxis()->SetTitleFont(62);
  hr->GetYaxis()->SetTitleOffset(1.30);
  hr->GetYaxis()->SetLabelSize(0.045);
  hr->SetNdivisions(505, "X");
  
   canv->SetLogy();
   hr->SetMinimum(10.);



  outerBand->SetLineWidth(1.);
  outerBand->SetLineColor(kBlack);
  outerBand->SetFillColor(TColor::GetColor(252,241,15));
  outerBand->Draw("3");
  
  innerBand->SetLineWidth(1.);
  innerBand->SetLineColor(kBlack);
  innerBand->SetFillColor(kGreen);
  innerBand->Draw("3same");
  
  expected->SetLineColor(kBlack);
  expected->SetLineWidth(3);
  expected->SetLineStyle(2);
  expected->Draw("L");

  observedl->SetLineColor(kBlack);
  observedl->SetLineWidth(3);
  observedl->SetLineStyle(1);
  observedl->SetMarkerStyle(20);
  observedl->Draw("LP");



  double mH_exclTH[6] = {700,800,900,1000,1000, 700};
  double shExclTH[6] = {1.004,0.871,0.769, 0.689, 1.,1.};

  TGraph *ExclTH = new TGraph(6,mH_exclTH,shExclTH);
  ExclTH->SetFillColor(kBlue);
  ExclTH->SetFillStyle(3001);
  //ExclTH->Draw("FL");


  TLatex *text12 = new TLatex(0.2,0.94,"CMS");
  text12->SetNDC();
  text12->SetTextSize(0.05);
  text12->SetTextFont(62);
  text12->Draw();

 TLatex *text13 = new TLatex(0.7,0.94,"#bf{15.2 fb^{-1} (13 TeV)}");
  text13->SetNDC();
  text13->SetTextSize(0.05);
  text13->SetTextFont(62);
  text13->Draw();

  /*
  TLatex *text13 = new TLatex(0.4,0.54,"2015+2016 Model Independent");
  text13->SetNDC();
  text13->SetTextSize(0.05);
  text13->SetTextFont(62);
  text13->Draw();
  */

  TLegend* leg;
  //leg = new TLegend(0.63, 0.17,0.96, 0.425);
    leg = new TLegend(0.65, 0.65,0.95, 0.90);
  // leg = new TLegend(0.1, 0.70,0.35, 0.90);
  leg->SetBorderSize( 0 );
  leg->SetFillStyle( 1001 );
  leg->SetFillColor(kWhite); 
  leg->AddEntry( observedl , "Observed",  "LP" );
  leg->AddEntry( expected , "Expected",  "L" );
  leg->AddEntry( innerBand, "#pm 1#sigma",  "F" ); 
  leg->AddEntry( outerBand, "#pm 2#sigma",  "F" ); 
  //leg->AddEntry( ExclTH   , "#Gamma_{H^{#pm}}/m_{H^{#pm}} > 0.15",  "F" ); 

  leg->Draw("same");
  //canv.RedrawAxis("g");
  
  canv->RedrawAxis();
  

  ///CMS_lumi_v2( canv, 14, 11 );
  
  
   //chan->Draw();
   //-------------------------------------------------------------------------
   //Save histograms
   canv->Print("limits_UnblindedModelI_62.pdf");
}
